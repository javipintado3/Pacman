<!doctype html> 
<html lang="es"> 
<head> 
    <meta charset="UTF-8" />
    <title>PACMAN</title>
    <script src="phaser.js"></script>
    <style type="text/css">
        body {
            margin: 0;
        }
    </style>
</head>
<body>

<script type="text/javascript">

    var config = {
        type: Phaser.AUTO,
        width: 1280,
        height: 1280,
        physics: {
            default: 'arcade',
            arcade: {
                //FISICA(GRAVEDAD)
                gravity: { y: 0 },
                debug: false
            }
        },
        scene: {
            preload: preload,
            create: create,
            update: update
        }
    };

    var derecha;
    var arriba;
    var izquierda;
    var abajo;
    var map;
    var cursors;
    var tiled;
    var puntos;
    var ghost;
    var point;
    var suelo;
    var pared;
    var score = 0;
    var timeline;
    var scoreText;
    var ghost2;
    var ghost3;
    var ghost4;

    var game = new Phaser.Game(config);

    function preload ()
    {
        this.load.image('tiles', 'assets/azulejos.png');
        this.load.image('tiles1', 'assets/pacman-tiles.png');
        this.load.image('tiles2', 'assets/puntos.png');
        this.load.spritesheet('derecha', './assets/sprites/pacmanderecha.png', { frameWidth: 64, frameHeight: 64 });
        this.load.spritesheet('arriba', './assets/sprites/pacmanarriba.png', { frameWidth: 64, frameHeight: 64 });
        this.load.spritesheet('izquierda', './assets/sprites/pacmanizquierda.png', { frameWidth: 64, frameHeight: 64 });
        this.load.spritesheet('abajo', './assets/sprites/pacmanabajo.png', { frameWidth: 64, frameHeight: 64 });
        this.load.spritesheet('fantasma', 'assets/fantasmas.png', { frameWidth: 64, frameHeight: 64 });
        this.load.spritesheet('fantasma2', 'assets/fantasmas.png', { frameWidth: 64, frameHeight: 64 });
        this.load.spritesheet('fantasma3', 'assets/fantasmas.png', { frameWidth: 64, frameHeight: 64 });
        this.load.spritesheet('fantasma4', 'assets/fantasmas.png', { frameWidth: 64, frameHeight: 64 });
        this.load.audio('comecocos','assets/pacmanchomp.wav');
        this.load.audio('deadsound','assets/pacmandeath.wav');
        this.load.audio('victorysound','assets/pacmanvictory.wav');


        //TEXTURA MAPA
        this.load.image('tiles', 'assets/azulejos.png');
        this.load.image('tiles1', 'assets/pacman-tiles.png');
        this.load.image('tiles2', 'assets/puntos.png');
        // MAPA
        this.load.tilemapTiledJSON('map', 'assets/MapaPacman.json');
    }

    function create ()
    {
      var map = this.make.tilemap({ key: 'map', tileWidth: 32, tileHeight: 32 })
      var tiles = map.addTilesetImage('azulejos', 'tiles');
      var tiles1 = map.addTilesetImage('pacman-tiles', 'tiles1');
      var tiles2 = map.addTilesetImage('puntos', 'tiles2');
      
      //CAPAS
       pared = map.createLayer("pared", tiles, 0, 0);
       suelo = map.createLayer("suelo", tiles1, 0, 0);
       point = map.createLayer("point", tiles2, 0, 30);
    
      //   PLAYER (GENERACIÓN DEL PERSONAJE)
      //Cordenadas de respawn
     player = this.physics.add.sprite(120, 672, 'izquierda');
     ghost = this.physics.add.sprite(970, 670, 'fantasma');
     ghost2 = this.physics.add.sprite(514, 220, 'fantasma2');
     ghost3 = this.physics.add.sprite(288, 1022, 'fantasma3');
     ghost4 = this.physics.add.sprite(640, 1022, 'fantasma4');
    
        // CAMARA PARA EL MAPA
       this.cameras.main.zoom=0.4;
       this.cameras.main.y=-350; 


       // COLISIONES
       pared.setCollision([34,36], true, "tiles");

       //puntos colison
       point.setTileIndexCallback(149, comerpuntos, this);

       // COLISIONES entre los objetos y personajes
        this.physics.add.collider(player, pared);
        this.physics.add.overlap(player, point);
        this.physics.add.collider(player, ghost);
        this.physics.add.collider(pared, ghost);

       //FLECHAS DEL TECLADO
       cursors = this.input.keyboard.createCursorKeys();

        //ANIMACIONES PACMAN
        this.anims.create({
        key: 'izquierda',
        frames: this.anims.generateFrameNumbers('izquierda', { start: 0, end: 2 }),
        frameRate: 10,
        repeat: -1
        });

        this.anims.create({
        key: 'derecha',
        frames: this.anims.generateFrameNumbers('derecha', { start: 0, end: 2 }),
        frameRate: 10,
        repeat: -1
        });

        this.anims.create({
        key: 'arriba',
        frames: this.anims.generateFrameNumbers('arriba', { start: 0, end: 2 }),
        frameRate: 10,
        repeat: -1
        });

        this.anims.create({
        key: 'abajo',
        frames: this.anims.generateFrameNumbers('abajo', { start: 0, end: 2 }),
        frameRate: 10,
        repeat: -1
        });

        //ANIMACIONES FANTASMA 1

        this.anims.create({
        key: 'ghostizquierda',
        frames: this.anims.generateFrameNumbers('fantasma', { start: 2, end: 3 }),
        frameRate: 10,
        repeat: -1
        });
 
        this.anims.create({
        key: 'ghostderecha',
        frames: this.anims.generateFrameNumbers('fantasma', { start: 0, end: 1 }),
        frameRate: 10,
        repeat: -1
        });

        this.anims.create({
        key: 'ghostarriba',
        frames: this.anims.generateFrameNumbers('fantasma', { start: 4, end: 5 }),
        frameRate: 10,
        repeat: -1
        });

        this.anims.create({
        key: 'ghostabajo',
        frames: this.anims.generateFrameNumbers('fantasma', { start: 6, end: 7 }),
        frameRate: 10,
        repeat: -1
        });

        //BUCLE DE MOVIMIENTO FANTASMA 1
        
        var timeline = this.tweens.timeline({

            targets: ghost,
            loop: -1,

        tweens: [{
            targets: ghost,
            x: 735,
            ease: 'Power1',
            duration: 2000
        },
        {
            targets: ghost,
            y: 320,
            ease: 'Power1',
            duration: 2000
        },
         {
            targets: ghost,
            x: 960,
            ease: 'Power1',
            duration: 2000
        },
        {
            targets: ghost,
            y: 670,
            ease: 'Power1',
            duration: 2000
        },]
    })

        //BUCLE DE MOVIMIENTO FANTASMA 2

        var timeline = this.tweens.timeline({

            targets: ghost2,
            loop: -1,

        tweens: [{

            targets: ghost2,
            x: 65,
            ease: 'Power1',
            duration: 2000
        },
        {
            targets: ghost2,
            y: 65,
            ease: 'Power1',
            duration: 2000
        },
        {
            targets: ghost2,
            x: 513,
            ease: 'Power1',
            duration: 2000
        },
        {
            targets: ghost2,
            y: 225,
            ease: 'Power1',
            duration: 2000
        },]
    })

        //BUCLE DE MOVIMIENTO FANTASMA 3

        var timeline = this.tweens.timeline({

        targets: ghost3,
        loop: -1,

        tweens: [{

        targets: ghost3,
        x: 510,
        ease: 'Power1',
        duration: 1700
    },
    {
        targets: ghost3,
        y: 1245,
        ease: 'Power1',
        duration: 1700
    },
    {
        targets: ghost3,
        x: 70,
        ease: 'Power1',
        duration: 1700
    },
    {
        targets: ghost3,
        y: 1150,
        ease: 'Power1',
        duration: 1700   
    },
    {
        targets: ghost3,
            x: 285,
            ease: 'Power1',
            duration: 1700
    },
    {
        targets: ghost3,
        y: 1025,
        ease: 'Power1',
        duration: 1700 
    }]
})

        //BUCLE DE MOVIMIENTO FANTASMA 4

        var timeline = this.tweens.timeline({

        targets: ghost4,
        loop: -1,

    tweens: [{

        targets: ghost4,
        x: 1020,
        ease: 'Power1',
        duration: 1700
    },
    {
        targets: ghost4,
        y: 1150,
        ease: 'Power1',
        duration: 1700
    },
    {
        targets: ghost4,
        x: 1088,
        ease: 'Power1',
        duration: 1700
    },
    {
        targets: ghost4,
        y: 1245,
        ease: 'Power1',
        duration: 1700   
    },
    {
        targets: ghost4,
        x: 638,
        ease: 'Power1',
        duration: 1700
    },
    {
        targets: ghost4,
        y: 1025,
        ease: 'Power1',
        duration: 1700 
    }]
})


         //PUNTUACIÓN AL COMER PUNTOS
        scoreText = this.add.text(16, -42, 'PUNTOS: 0', { fontSize: '40px', fill: '#FFF', });

        //COLISION DE MUERTE (PACMAN Y FANTASMAS)
        this.physics.add.collider(player, ghost, muerte, null, this);
        this.physics.add.collider(player, ghost2, muerte, null, this);
        this.physics.add.collider(player, ghost3, muerte, null, this);
        this.physics.add.collider(player, ghost4, muerte, null, this);

 
    }

    function comerpuntos (sprite, tile)
     {
        point.removeTileAt(tile.x, tile.y);
        this.sound.play('comecocos');

        score += 1;
        scoreText.setText('PUNTOS: ' + score);
        
        //IF PARA QUE EL JUEGO SE PARE AL GANAR
        if (score == 332) { 
            this.sound.play('victorysound');
            // this.escene.pause();
            // setTimeout(function(){
                window.location.href = 'victoria.html';
            // },2000);
            
            

        }

    }
    

    function update()
{
        //MOVIMIENTO PACMAN  
        if (cursors.left.isDown)
    {
        player.setVelocityX(-160);

        player.anims.play('izquierda', true);

        
    }
    else if (cursors.right.isDown)
    {
        player.setVelocityX(160);

        player.anims.play('derecha', true);

        
    }
    else if (cursors.up.isDown) {

        player.setVelocityY(-160);

        player.anims.play('arriba', true);

        
    }
    else if (cursors.down.isDown) 
    {
        player.setVelocityY(160);

        player.anims.play('abajo', true);

        
    }
    
    
    //ANIMACIÓN DE OJOS FANTASMA 1
    
    if (ghost.body.x==703) {

    ghost.anims.play('ghostarriba', true);
    
    }else if (ghost.body.x==928) {

        ghost.anims.play('ghostabajo', true);
    }
    if (ghost.body.y==638) {

    ghost.anims.play('ghostizquierda', true);

    }else if (ghost.body.y==288) {

    ghost.anims.play('ghostderecha', true);
    } 

    //ANIMACIÓN DE OJOS FANTASMA 2
    console.log(ghost2.body.y);

    if (ghost2.body.x==33) {

    ghost2.anims.play('ghostarriba', true);

    }else if (ghost2.body.x==481) {

    ghost2.anims.play('ghostabajo', true);
    }
    if (ghost2.body.y==188) {

    ghost2.anims.play('ghostizquierda', true);

    }else if (ghost2.body.y==33) {

    ghost2.anims.play('ghostderecha', true);
    
    } else if (ghost2.body.y==193) {

    ghost2.anims.play('ghostizquierda', true);
    } 
    
    //ANIMACIÓN DE OJOS FANTASMA 3
    

    if (ghost3.body.x==253) {

    ghost3.anims.play('ghostarriba', true);

    }else if (ghost3.body.x==38) {

    ghost3.anims.play('ghostarriba', true);

    }else if (ghost3.body.x==478) {

    ghost3.anims.play('ghostabajo', true);
    }
    if (ghost3.body.y==1213) {

    ghost3.anims.play('ghostizquierda', true);

    }else if (ghost3.body.y==993) {

    ghost3.anims.play('ghostderecha', true);

    }else if (ghost3.body.y==1118) {

    ghost3.anims.play('ghostderecha', true);
} 
    //ANIMACIÓN DE OJOS FANTASMA 4
    

    if (ghost4.body.x==606) {

    ghost4.anims.play('ghostarriba', true);

    }else if (ghost4.body.x==1056) {

    ghost4.anims.play('ghostabajo', true);

    }else if (ghost4.body.x==988) {

    ghost4.anims.play('ghostabajo', true);
    }
    if (ghost4.body.y==1213) {

    ghost4.anims.play('ghostizquierda', true);

    }else if (ghost4.body.y==993) {

    ghost4.anims.play('ghostderecha', true);

    }else if (ghost4.body.y==1118) {

    ghost4.anims.play('ghostderecha', true);
} 

}

    //Función para que funciona la muerte al colisionar con los fantasmas

    function muerte (player,ghost) {

        this.sound.play('deadsound');

        this.physics.pause();

        window.location.href = 'dead.html';

        this.sound.play('deadsound');

        player.seTint(0xff0000);

        gameOver = true;

        

    }


</script>

</body>
</html>